!function(e,t){function n(e){return o.concat(e).map(function(e){return self.data.url(e)})}e.openDialogWindow=function(t){t.features.height&&(t.features.outerHeight=t.features.height,delete t.features.height),t.features.width&&(t.features.outerWidth=t.features.width,delete t.features.width);var n=g_window_utils.openDialog({features:e.stringifyFeatures(t.features)});n.addEventListener("load",function(){var e=t.loadHandler;t.loadHandler=function(t){f[t.tabDetails.frameID]=n,e&&e(t)},r(t,function(e){g_tabs.activeTab.on("ready",e),t.closeHandler&&g_tabs.activeTab.on("close",function(){t.closeHandler(n)}),g_tabs.activeTab.url=t.url})})};var o=["topics.js","platformRequestFramework.js","backgroundRequester.js","extensionMessaging.js","extensionReflection.js","interfaces.js","contentScriptInterface.js","LPFrameIdentityManager.js","initializeInjected.js"],a=function(e){return e?{tabURL:e.url,tabID:e.id}:null},i=function(){return function(t,o){if(0===t.indexOf(self.data.url("")))throw new Error("JS injection not supported for extension pages. Please load JS dynamically on page itself.");return g_page_mod.PageMod({include:t,contentScriptFile:n(o.files),contentScriptWhen:"start",attachTo:o.allFrames?["top","frame"]:"top",onAttach:function(t){var n=e.initializeRequestFramework({sendContentScript:function(e){return t.port.emit("message",e),!0}});t.port.on("message",n.requestHandler)}})}}(),r=function(e,t){var n=null,o=void 0;e.inject&&(n=i(e.url,e.inject)),e.loadHandler&&(o=function(t){n&&n.destroy(),LPTabs.get({tabID:t.id,callback:e.loadHandler}),t.removeListener("ready",o)}),t(o)};e.openTab=function(e){r(e,function(t){g_tabs.open({url:e.url,inBackground:e.inactive,onReady:t,onClose:e.closeHandler})})},e.navigateTab=function(e){r(e,function(t){for(var n,o=0;o<g_tabs.length;o++)g_tabs[o].id===e.tabId&&(n=g_tabs[o]);g_tabs.open({url:e.url,inBackground:!1,onReady:t,onClose:e.closeHandler,onOpen:function(e){n&&(e.index=n.index,n.close())}})})},e.openWindow=function(e){r(e,function(t){g_windows.browserWindows.open({url:e.url,onOpen:function(n){if(n.tabs.length>0){var o=n.tabs[0];o.on("ready",t),o.on("close",e.closeHandler)}}})})},e.openSame=function(e){r(e,function(t){var n=g_tabs.activeTab;n.on("ready",t),n.on("close",e.closeHandler),n.url=e.url})},e.activateTab=function(e){var t=s[e.frameID].tab;t.activate(),t.window.activate()},e.getCurrentTab=function(e){var t=g_tabs.activeTab;t?LPTabs.get({tabID:t.id,callback:e}):e(null)},e.getCurrentTabDetails=function(e){var t=g_tabs.activeTab;e(a(t))},e.onTabUpdated=function(e){if("function"==typeof e){var t=function(t){LPTabs.get({tabID:t.id,callback:e})};g_tabs.on("ready",t)}return function(){g_tabs.removeListener("ready",t)}},e.onTabActivated=function(e){if("function"==typeof e){var t=function(t){LPTabs.get({tabID:t.id,callback:e})};g_tabs.on("activate",t)}return function(){g_tabs.removeListener("activate",t)}},e.onTabClosed=function(e){if("function"==typeof e){var t=function(){e(g_tabs.activeTab.id)};g_tabs.on("close",t)}return function(){g_tabs.removeListener("close",t)}};var c,l,s={},f={},u={},d=function(t,n){t.port.on("message",function(o){var i=u[o.sourceFrameID];if(!i){i=e.initializeRequestFramework({sendContentScript:function(e){t.port.emit("message",e)},tabDetails:a(t.tab),callback:n&&n.callback}),u[i.frameID]=i,s[i.frameID]=t;var r=function(){delete s[i.frameID],delete f[i.frameID],delete u[i.frameID],i.disconnectHandler()};t.on("detach",r),t.on("error",r)}i.requestHandler(o)})},g=function(e){if("undefined"==typeof g_panel)return null;var t,n,o=[],a=g_panel.Panel({width:350,height:400,contentURL:getchromeurl(e),contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",onShow:function(){t=g_windows.browserWindows.activeWindow},onHide:function(){g_firefox_button.state(t,{checked:!1}),i()},contextMenu:!0});d(a,{callback:function(e){n=e,n.LPPlatform.onLoad(function(){o.forEach(function(e){e()})})}});var i=function(){n&&n.ExtensionDropdown.reset()},r=function(e){n?e():o.push(e),a.show({position:g_firefox_button})};this.openPopoverDialog=function(e,t){r(function(){n.ExtensionDropdown.openDialog(e,t)})},this.show=function(e){r(function(){n.ExtensionDropdown.setBigIcons&&n.ExtensionDropdown.setBigIcons(g_bigicons),n.ExtensionDropdown.open()})},this.hide=function(){a.hide()},this.resize=function(e,t){a.resize(e,t)},this.getInterface=function(){return n}};e.openPopoverDialog=function(e,t){l&&"function"==typeof l.openPopoverDialog&&l.openPopoverDialog(e,t)},e.openDropdownPopover=function(){l&&"function"==typeof l.show&&l.show()},e.openLoginPopover=function(){c&&c.show()},e.closePanel=function(e){s[e.frameID].hide()},e.resizePanel=function(e,t,n){s[n.frameID].resize(e,t)},e.closeTab=function(e){s[e.frameID].tab.close()},e.resizeDialogWindow=function(e,t,n){f[n.frameID].resizeTo(e,t)},e.closePopovers=function(){c&&"function"==typeof c.hide&&c.hide(),l&&"function"==typeof l.hide&&l.hide(),g_firefox_login_panel&&(g_firefox_login_panel.destroy(),g_firefox_login_panel=null),g_firefox_panel&&(g_firefox_preload_menu?g_firefox_panel.hide():(g_firefox_panel.destroy(),g_firefox_panel=null))},e.initialize=function(){c=new g("extensionLogin.html",Interfaces.ExtensionLoginDropdownInterface),l=new g("extensionDropdown.html",Interfaces.ExtensionDropdownInterface),g_page_mod.PageMod({include:["*","about:*"],contentScriptFile:self.data.url("onloadwff.js"),contentScriptWhen:"start",attachTo:["existing","top","frame"],onAttach:function(e){e.port.on("lpmessage",function(t){t.worker=e,message_handler(t)}),d(e)}}),g_page_mod.PageMod({include:[self.data.url("backgroundFrame.html")+"*"],contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",attachTo:"frame",onAttach:d}),g_page_mod.PageMod({include:getchromeurl("*",!0),exclude:[self.data.url("vault.html")+"*",self.data.url("tabDialog.html")+"*",self.data.url("contentScriptDialog.html")+"*",self.data.url("backgroundFrame.html")+"*",self.data.url("contentScriptDialogBackground.html")+"*"],contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",attachTo:["existing","top","frame"],onAttach:function(e){e.port.on("message",function(t){void 0!==t.messagefromurl&&-1!=t.messagefromurl.indexOf("skip_pagemod=1")||(t.target=e,message_handler(t))})}}),g_page_mod.PageMod({include:[self.data.url("vault.html")+"*",self.data.url("tabDialog.html")+"*"],contentScriptFile:self.data.url("ajaxContentScript.js"),contentScriptWhen:"start",attachTo:["existing","top"]}),g_page_mod.PageMod({include:["https://lastpass.com/*"],contentScriptFile:n(["provisioning/websiteConnector.js","provisioning/websiteConnectorInit.js"]),contentScriptWhen:"start",attachTo:["existing","top","frame"],onAttach:function(e){d(e)}}),get_all_windows({populate:!0},function(t){for(var n=null,o=0;o<t.length;o++)for(var a=0;a<get_tabs_length(t[o]);a++){var i=get_tabs(t[o])[a],r=gettabid(i),c=gettaburl(i);-1!=c.indexOf("?lpInstall")&&(n=r)}null!==n&&(e.openTabDialog("createAccountSimple",{tabId:n}),LPServer.ajax({type:"POST",data:{v:"1",t:"event",ec:"download-software",ea:"overlay_lastpass-free-download-complete-firefox",tid:"UA-338639-2"},url:"https://www.google-analytics.com/collect"}))})},e.updateBigIcons=function(e){e&&l&&"function"==typeof l.getInterface&&l.getInterface().ExtensionDropdown.setBigIcons(e)},e.getFavicon=function(e){if(e.url&&e.callback){var t=require("sdk/places/favicon");t&&t.getFavicon?t.getFavicon(e.url).then(e.callback):e.callback(null)}}}(LPPlatform);